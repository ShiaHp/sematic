const { MongoClient } = require("mongodb");

// connect to your Atlas deployment
const uri = "";

const client = new MongoClient(uri).connect();

// async function run() {
//   try {
//     const database = client.db("files");
//     const collection = database.collection("fileUpload");

//     // define your Atlas Vector Search index
//     const index = {
//       name: "vector_index",
//       type: "vectorSearch",
//       definition: {
//         fields: [
//           {
//             type: "vector",
//             numDimensions: 1536,
//             path: "plot_embedding",
//             similarity: "euclidean",
//           },
//         ],
//       },
//     };

//     const result = await collection.createSearchIndex(index);
//     console.log(result);
//   } finally {
//     // await client.close();
//   }
// }

run().catch(console.dir);

db.fileUpload.aggregate([
  {
    $vectorSearch: {
      index: "vector_index",
      path: "embedding",
      queryVector: [
        0.05894262, -0.049346227, -0.015279321, -0.089034535, 0.07470229,
        -0.0049041174, -0.040643137, -0.0021667702, 0.01537358, -0.008157234,
        0.04298249, 0.008940541, -0.035611182, -0.024544042, 0.033790506,
        -0.033897404, 0.053528953, -0.010381143, 0.022640528, -0.0033916663,
        0.0090481145, -0.020745765, 0.029502561, -0.022161987, 0.029856823,
        -0.023512501, 0.029445091, 0.025579922, -0.01713221, 0.057351902,
        -0.04363188, 0.0126993805, -0.077758126, -0.051075015, 0.02975754,
        -0.008051655, -0.0000878059, 0.017112471, -0.021726614, 0.030437477,
        -0.026858836, 0.0071175457, -0.0465565, -0.026221894, 0.0225217,
        -0.011003594, -0.018226963, -0.005689284, 0.02677733, -0.088204876,
        0.051463302, -0.031128677, 0.021112964, -0.0041139624, -0.005604878,
        -0.07516879, 0.044725068, 0.002148661, -0.05654257, 0.037510887,
        -0.040679004, 0.030007407, 0.006074007, 0.06536827, -0.03187833,
        0.0014653788, -0.029559907, 0.06778403, 0.047095045, -0.015982334,
        0.008797102, -0.019352948, 0.058106847, -0.039855413, -0.043006867,
        -0.014984035, 0.029505778, 0.04464996, 0.01176306, -0.011193205,
        -0.04447531, -0.061600253, 0.0032416587, -0.012511532, -0.08231534,
        0.029419228, -0.0046863756, 0.055347122, 0.036720037, 0.07996007,
        -0.022451, -0.01895503, 0.0087685045, -0.0722217, 0.012871519,
        0.06057339, -0.04178018, -0.00288271, -0.0339957, -0.022404302,
        -0.013293843, -0.04422226, -0.049061846, 0.00506229, 0.00637176,
        0.05353372, 0.004537955, 0.017433569, -0.0027049317, 0.017021185,
        -0.040927492, 0.029928679, -0.03784684, -0.034022737, 0.03503659,
        -0.04036424, -0.032660376, 0.08826423, 0.0066799005, 0.040556733,
        0.0002580185, 0.02213891, 0.083588995, 0.02033023, 0.0468669,
        0.021162163, 0.017434351, 0.03769028, 0.07101186, 0.0021350086,
        -0.050762475, -0.015389786, 0.0043518357, 0.020958565, 0.081566714,
        0.07354888, 0.03934656, 0.0017750522, 0.036181945, 0.051588055,
        0.0011256961, -0.018996952, 0.018980898, 0.032818533, -0.014572001,
        0.031855106, -0.004076641, -0.047152337, 0.08544406, -0.013907404,
        -0.025343595, -0.033843867, -0.07509615, 0.04641334, 0.0231554,
        0.014880565, -0.020686174, 0.019597169, -0.013172714, 0.02866,
        0.043452196, 0.030974349, 0.023829898, 0.033636928, -0.026808735,
        -0.05109627, 0.0027029433, 0.029460493, -0.0013448506, 0.02378848,
        -0.003559112, 0.005266103, -0.027862586, -0.042369105, -0.002944939,
        -0.075860836, -0.010790755, -0.056993365, -0.031545103, -0.03989719,
        -0.029444067, -0.051754367, 0.028567638, -0.012214428, 0.008973196,
        -0.054850306, 0.06874347, 0.0023743324, -0.0035462854, 0.008776322,
        -0.03365204, 0.006892187, -0.029446702, 0.012602786, -0.03974056,
        0.042822253, -0.054008674, 0.02579541, 0.041991338, 0.024509711,
        -0.024706226, 0.07715855, 0.011160854, 0.018069612, 0.049938787,
        -0.010246412, 0.06468407, -0.07116129, 0.012418937, -0.016198438,
        -0.037710387, 0.0019603528, -0.0614441, 0.002034431, 0.02969632,
        0.051121086, -0.01269341, 0.023937399, 0.03237245, -0.013926316,
        0.03630945, 0.00012216323, -0.01632809, 0.019643482, 0.003010992,
        0.044547886, -0.029361704, 0.019913213, 0.010469421, -0.048945457,
        0.00800841, 0.015059955, 0.0051793973, 0.009229147, 0.041442644,
        0.016372409, 0.027893294, -0.010205782, 0.016588083, 0.04838598,
        -0.03231994, 0.049661122, 0.036730606, -0.035974275, -0.06871605,
        -0.014543235, -0.05985402, 0.041181665, -0.008251458, 0.013295457,
        -0.005655924, -0.08352699, 0.051754393, -0.008763355, -0.06336489,
        0.022345072, -0.06834352, 0.0008869372, -0.013677709, 0.005232151,
        0.049959145, -0.014091544, -0.039711967, 0.0060242233, -0.034875523,
        0.02339138, -0.00436331, -0.046527054, -0.006667631, 0.019858913,
        -0.020119252, -0.023854129, 0.06930253, -0.0047159586, -0.033774424,
        -0.008832652, -0.021494035, 0.00078906125, -0.0033386296, 0.029775662,
        0.026573135, 0.03510567, 0.029195666, -0.04160048, -0.06357232,
        0.00344811, -0.046733696, -0.01895438, 0.010188425, 0.040896572,
        -0.09378538, -0.016626814, -0.03623163, -0.0085265, -0.06289825,
        0.027230302, -0.033525284, 0.041847017, -0.004325842, 0.018220171,
        -0.0045049675, 0.0015351285, 0.019997338, -0.06029881, 0.021512493,
        0.030231234, -0.0020138454, -0.070123, 0.012227944, 0.02506993,
        -0.0060562254, -0.029656343, -0.049942408, -0.0046134586, 0.057025567,
        0.022556279, -0.016456874, 0.027262026, 0.017081866, 0.09925699,
        -0.04834704, 0.060403977, -0.03182212, -0.014862514, 0.012238826,
        0.002554347, -0.0073263557, 0.020577103, -0.02269174, -0.015854944,
        -0.018296149, 0.026701583, -0.00074608705, -0.01138339, 0.009260856,
        0.04794306, -0.016490836, -0.0071314466, -0.014920099, -0.006638016,
        0.05268442, -0.011166455, -0.057483505, -0.06893617, 0.038205475,
        -0.017136209, -0.037656162, 0.0053600827, 0.0116114225, 0.025582459,
        0.033644795, 0.039374415, 0.0076638623, -0.0033973176, -0.02999555,
        0.0067169624, 0.033959627, 0.028063683, 0.042506292, -0.035614878,
        0.008052781, 0.009601588, 0.023322592, -0.025502421, 0.004084253,
        0.052422438, -0.005410579, 0.0073741134, 0.009024569, 0.036162723,
        -0.008832056, -0.038793813, 0.045870494, -0.019379966, -0.004948739,
        -0.038239192, -0.015352899, -0.040690303, -0.0048568305, -0.037003197,
        -0.005367854, -0.031431526, 0.025052948, -0.0069939573, -0.012653278,
        -0.01964396, 0.07044287, 0.05208797, 0.021833666, -0.0068290527,
        0.021265455, -0.009464828, 0.095801815, -0.0033047076, -0.007559811,
        -0.021523451, 0.0047632447, -0.059621606, 0.034305993, -0.033440523,
        -0.039666597, 0.0032130876, -0.072697, -0.024695918, -0.038452473,
        -0.05115352, 0.020913234, 0.012612539, -0.01906663, -0.004248303,
        0.043001402, 0.052284114, 0.0065745893, -0.062480647, -0.04880381,
        -0.034142144, 0.038274642, -0.0136089055, 0.034966715, 0.02997555,
        0.005491112, 0.052914876, 0.023147078, -0.011733131, -0.0049239136,
        -0.04128125, 0.0499959, -0.018120004, -0.00080035656, 0.0017189354,
        0.006194442, 0.04724423, -0.027421072, -0.022005165, -0.02886381,
        -0.0498457, 0.04740678, 0.0006831087, -0.025475143, 0.050429974,
        0.006250635, -0.058491834, 0.0313688, -0.008794615, -0.018422848,
        -0.0489069, 0.0067131985, -0.06640142, 0.066236556, -0.07482749,
        -0.03067971, -0.054477796, -0.036203362, -0.039825346, 0.01403259,
        -0.032981195, 0.029918946, 0.07701818, 0.006964941, 0.0022008284,
        0.023275368, 0.0055814264, -0.040676955, -0.057547543, 0.0607298,
        -0.0020515285, 0.008399219, -0.028726306, 0.011022617, 0.002457303,
        -0.03279206, -0.040486295, -0.008778597, 0.035881627, -0.004358677,
        0.0031100844, -0.024719741, -0.049607474, 0.021160504, -0.030796275,
        0.011116677, -0.042040464, 0.026393574, -0.015115222, -0.034264516,
        0.0028354006, -0.032280393, -0.057275604, -0.035412487, 0.023899613,
        0.011596762, -0.010888997, -0.013531813, -0.0035253533, 0.0003362302,
        0.017780561, -0.00458128, -0.008391132, 0.049702875, 0.036433708,
        -0.053624894, -0.0008866528, -0.028629933, -0.009437326, 0.031959597,
        -0.09455966, 0.01605449, 0.04190953, -0.02171479, 0.03142737,
        0.017438238, -0.006103302, -0.011108243, -0.0024304937, 0.07276637,
        -0.0033307176, -0.011558434, 0.0105906, 0.024789842, 0.03001852,
        0.042730946, 0.01638018, -0.07577562, -0.028614482, 0.026293736,
        0.012443674, -0.002984487, 0.015530343, -0.07400567, 0.017854035,
        -0.0056951544, 0.11059769, -0.03978914, 0.02163637, -0.030208249,
        -0.031752627, -0.017854331, 0.01788808, -0.01803074, 0.004244603,
        -0.02012572, 0.010527256, 0.007934366, 0.022170216, 0.030844796,
        -0.018185116, -0.003373654, -0.08047584, 0.022673514, 0.0071958425,
        0.0057309587, 0.000863182, 0.043408047, -0.03491187, 0.023957299,
        -0.04492176, 0.032658897, -0.034290984, -0.0053785266, -0.025862336,
        -0.024942892, -0.024482781, 0.0064491522, 0.00031277494, 0.099948585,
        -0.012973358, 0.020273488, 0.013589441, 0.046546917, 0.011440675,
        0.000105435676, 0.034546092, 0.037150394, 0.011907458, 0.015637431,
        -0.024252381, -0.02579703, -0.010756823, 0.03224346, 0.032562617,
        0.055197045, -0.016256366, 0.02301012, 0.054978047, -0.015666964,
        0.049314626, 0.048280854, -0.04297666, 0.009401555, 0.008677162,
        0.0022641937, 0.03332666, -0.042463113, 0.018838452, -0.011088796,
        0.029130919, 0.06643249, 0.017062068, -0.011317033, 0.018936895,
        0.008101624, -0.07744181, 0.10928655, -0.025498964, 0.0693755,
        0.016288636, -0.007144095, -0.052018967, -0.021558233, 0.017023237,
        -0.012791135, -0.026657559, 0.016773649, 0.02100599, -0.017229667,
        0.02339119, 0.03582582, 0.012793495, -0.030423585, -0.077360995,
        -0.032663234, -0.040273663, 0.03816437, -0.012003584, 0.06911112,
        -0.031058483, 0.04506239, -0.024465743, 0.048709054, 0.043437444,
        -0.0057197153, 0.06443703, -0.0064051873, -0.034470394, -0.039400194,
        -0.010968989, 0.02806344, -0.027314361, 0.018089864, 0.01147572,
        -0.06725772, -0.029340236, 0.052864786, -0.012266709, -0.0056566102,
        0.07864281, 0.008298903, -0.076929085, -0.03557257, 0.015954126,
        -0.055549834, -0.03247292, -0.017024286, -0.020624984, 0.018572684,
        -0.0035009074, -0.009527355, -0.07266633, 0.0026110194, -0.0564423,
        0.014797705, 0.0434815, -0.03932037, -0.0033239042, -0.017965415,
        -0.028200941, -0.05233587, -0.084985174, 0.0030883802, 0.013180194,
        -0.06075464, 0.01790916, 0.025011735, -0.026205502, 0.022203596,
        0.009561997, -0.001369677, 0.0478768, -0.01800807, 0.032506146,
        0.0048093935, -0.055787966, -0.052214824, 0.01698514, -0.0011813589,
        0.035163898, 0.02067068, -0.043221183, -0.02037675, -0.017128643,
        0.03883622, 0.027952662, -0.013113776, 0.018902741, 0.09874931,
        -0.02100387, -0.041141134, 0.00570119, -0.011007612, 0.062232394,
        -0.004706935, -0.0129744625, -0.01380965, 0.009877581, -0.0035017482,
        0.031929616, -0.046810288, 0.02316615, 0.0508137, -0.01404373,
        0.0075759166, 0.0019745221, -0.058169737, -0.01227554, -0.022511676,
        -0.031054389, 0.01687195, -0.055950485, 0.009121337, 0.026419153,
        0.0028230273, -0.01470543, 0.023059044, -0.07751051, -0.011493131,
        0.04489636, -0.021520415, 0.024596056, -0.044077147, -0.02013935,
        0.085022025, -0.07193138, -0.024910575, 0.05206207, -0.0631917,
        0.03826041, -0.015516491, 0.023766456, -0.043227106, -0.06665383,
        -0.0002469305, 0.009870786, 0.055086367, 0.002414221, 0.021591593,
        -0.03443437, -0.01775401, -0.01110033, -0.011576793, -0.004144037,
        -0.04005284, -0.000084065476, 0.026479058, 0.0941159, 0.0378543,
        -0.0071192323, -0.029100439, 0.008185694, -0.03860699, 0.050480414,
        -0.050551403, 0.03026555, 0.04439649, 0.018930368, 0.0025264265,
        0.05237803, -0.02177503, 0.013590982,
      ],
      numCandidates: 40,
      limit: 5,
    },
  },
  {
    $project: {
      _id: 0,
      text: 1,
      desc: 1,
      title: 1,
      score: {
        $meta: "vectorSearchScore",
      },
    },
  },
]);

db.fileUpload.find({ desc: "Wireless headphones" });
